# ‚úÖ Railway Deployment Checklist

## üìã Pre-Deployment Checklist

### 1. Code & Configuration
- [x] `package.json` memiliki script `build`, `start`, `postinstall`
- [x] `railway.json` sudah dibuat
- [x] `.railwayignore` sudah dibuat
- [x] `prisma/schema.prisma` configured untuk PostgreSQL
- [x] `.env.example` sudah lengkap
- [x] `.gitignore` mencakup `.env` dan `node_modules`
- [x] Health check endpoint `/health` tersedia
- [x] CORS configuration support environment variable

### 2. Environment Variables yang Diperlukan
Siapkan nilai-nilai berikut untuk di-set di Railway:

```env
# ‚úÖ Required
NODE_ENV=production
AI_PROVIDER=gemini
GOOGLE_GENERATIVE_AI_API_KEY=AIzaSyC05rgD-KyIwI5kgYlC_YL59U7ZO9zyfoQ
GEMINI_MODEL=gemini-2.5-flash

# ‚úÖ Auto-generated by Railway
DATABASE_URL=<akan di-set otomatis oleh Railway PostgreSQL>

# ‚ö†Ô∏è Update setelah deploy frontend
FRONTEND_URL=https://your-frontend-domain.vercel.app

# üìù Optional
LOG_LEVEL=info
PORT=5000
```

### 3. Database
- [x] Prisma migrations sudah dibuat
- [x] Schema sudah final
- [x] Migration akan auto-run saat deploy (via `startCommand`)

---

## üöÄ Deployment Steps

### Step 1: Push ke GitHub
```bash
git add .
git commit -m "chore: add Railway deployment configuration"
git push origin main
```

### Step 2: Setup Railway Project
1. Login ke https://railway.app
2. New Project ‚Üí Deploy from GitHub repo
3. Pilih repository `gap-arch-solvara`
4. Railway akan detect `be-gap-arch` folder

### Step 3: Add PostgreSQL Database
1. Klik "New" ‚Üí "Database" ‚Üí "Add PostgreSQL"
2. Railway akan auto-generate `DATABASE_URL`
3. Database akan auto-link ke backend service

### Step 4: Set Environment Variables
Di Railway Dashboard ‚Üí Service ‚Üí Variables, tambahkan:
- `NODE_ENV=production`
- `AI_PROVIDER=gemini`
- `GOOGLE_GENERATIVE_AI_API_KEY=AIzaSyC05rgD-KyIwI5kgYlC_YL59U7ZO9zyfoQ`
- `GEMINI_MODEL=gemini-2.5-flash`
- `FRONTEND_URL=http://localhost:3000` (update nanti setelah frontend deploy)
- `LOG_LEVEL=info`

### Step 5: Deploy
Railway akan otomatis:
1. Run `npm install`
2. Run `npm run build`
3. Run `npx prisma generate`
4. Run `npx prisma migrate deploy`
5. Start server dengan `node dist/index.js`

### Step 6: Verify
```bash
# Test health endpoint
curl https://your-app.up.railway.app/health

# Expected response:
# {"status":"OK","timestamp":"...","uptime":123.45,"environment":"production"}
```

---

## üîç Post-Deployment Verification

### 1. Check Deployment Status
- [ ] Build completed successfully
- [ ] Migrations ran without errors
- [ ] Server started and listening
- [ ] Health check returns 200 OK

### 2. Test API Endpoints
```bash
# Health check
curl https://your-app.up.railway.app/health

# Analyze endpoint
curl -X POST https://your-app.up.railway.app/api/analyze \
  -H "Content-Type: application/json" \
  -d '{
    "resumeText": "Software Engineer with Node.js",
    "jobDescriptionText": "Senior Developer with Docker"
  }'

# Stats endpoint
curl https://your-app.up.railway.app/api/stats
```

### 3. Check Logs
Di Railway Dashboard:
- [ ] No error messages in logs
- [ ] Database connection successful
- [ ] Prisma Client generated
- [ ] Server listening on correct port

---

## üîß Common Issues & Solutions

### Issue: "Cannot find module '@prisma/client'"
**Solution:**
- Pastikan `postinstall` script ada di `package.json`
- Redeploy atau run manual: `npx prisma generate`

### Issue: "Database connection failed"
**Solution:**
- Check `DATABASE_URL` di Variables
- Pastikan PostgreSQL service running
- Verify database dan backend service ter-link

### Issue: "CORS error from frontend"
**Solution:**
- Update `FRONTEND_URL` di Railway Variables
- Pastikan URL frontend benar (tanpa trailing slash)
- Redeploy backend

### Issue: "Port binding error"
**Solution:**
- Railway auto-assign port via `process.env.PORT`
- Code sudah handle ini: `const PORT = process.env.PORT || 5000`

---

## üìä Monitoring

### Railway Dashboard Metrics
- CPU usage
- Memory usage
- Network traffic
- Request count

### Application Logs
- Real-time logs di Railway Dashboard
- Filter by severity (info, warn, error)
- Download logs untuk analysis

### Health Checks
- Railway pings `/health` every 30s
- Auto-restart jika unhealthy
- Alert via email/Discord (configure di Settings)

---

## üéØ Next Steps After Backend Deploy

1. **Get Backend URL**
   - Copy dari Railway Dashboard
   - Format: `https://your-app.up.railway.app`

2. **Deploy Frontend**
   - Update `NEXT_PUBLIC_API_URL` dengan Railway URL
   - Deploy ke Vercel/Netlify

3. **Update CORS**
   - Set `FRONTEND_URL` di Railway Variables
   - Redeploy backend

4. **Test End-to-End**
   - Upload resume dari frontend
   - Verify analysis works
   - Check caching behavior

5. **Setup Custom Domain** (Optional)
   - Add custom domain di Railway
   - Update DNS records
   - Update CORS accordingly

---

## üí° Tips

- **Free Tier**: Railway gives $5/month credit (enough for testing)
- **Auto Deploy**: Enable GitHub integration untuk auto-deploy on push
- **Environment Groups**: Gunakan untuk manage multiple environments
- **Rollback**: Railway keeps deployment history untuk easy rollback
- **Logs**: Download logs untuk debugging offline

---

## üìû Resources

- Railway Docs: https://docs.railway.app
- PostgreSQL Guide: https://docs.railway.app/databases/postgresql
- Prisma + Railway: https://www.prisma.io/docs/guides/deployment/deployment-guides/deploying-to-railway

---

**Status**: ‚úÖ **BACKEND SIAP DEPLOY KE RAILWAY!**

Semua konfigurasi sudah lengkap. Tinggal push ke GitHub dan setup di Railway Dashboard.
